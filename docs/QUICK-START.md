# Быстрый старт - План тестирования

**Проект**: UT-103 CI/CD  
**Автор**: Бостанов Ф.А.  
**Дата**: 6 ноября 2025

---

## Краткое резюме

Данное руководство описывает быстрый запуск и тестирование CI/CD системы для 1С:Предприятие 8.3.12.

**Время выполнения**: ~30-60 минут (в зависимости от скорости интернета и производительности ПК)

---

## Этап 1: Первоначальное заполнение систем (10-15 минут)

### Шаг 1.1: Запуск сервисов

```powershell
# Запуск всех Docker контейнеров
docker-compose -f docker-compose-full-stack.yml up -d

# Ожидание инициализации (обязательно!)
Start-Sleep -Seconds 60

# Проверка статуса
docker ps
```

**Ожидаемый результат**: 4-5 контейнеров запущены (gitlab, redmine, sonarqube, postgres, cicd-service)

### Шаг 1.2: Получение токенов

**GitLab** (http://localhost:8929):
1. Войти: `root` / `gitlab_root_password`
2. User Settings → Access Tokens → Generate
3. Scope: `api`, `read_repository`, `write_repository`
4. Сохранить в `secrets/gitlab_token.txt`

**Redmine** (http://localhost:3000):
1. Войти: `admin` / `admin`
2. My account → API access key → Show
3. Сохранить в `secrets/redmine_api_key.txt`

**SonarQube** (http://localhost:9000):
1. Войти: `admin` / `admin` (сменить пароль при первом входе)
2. My Account → Security → Generate Token
3. Сохранить в `secrets/sonarqube_token.txt`

### Шаг 1.3: Полная инициализация

```powershell
# Запуск полной инициализации (все шаги автоматически)
.\scripts\setup\init-all.ps1
```

**Что произойдет**:
- ✅ Проверка зависимостей
- ✅ Проверка токенов
- ✅ Создание .env файла
- ✅ Загрузка эталонных данных
- ✅ Создание проектов в GitLab, Redmine, SonarQube
- ✅ Настройка GitLab Runner (интерактивно)

**Результат**: Все системы заполнены, проекты созданы, интеграции настроены.

---

## Этап 2: Автоматизированное тестирование (10-15 минут)

### Шаг 2.1: Запуск полного цикла тестов

```powershell
# Запуск всех автоматизированных тестов
.\scripts\testing\run-automated-tests.ps1
```

**Что тестируется**:
1. **PreCommit1C** - синтаксическая проверка модулей 1С
2. **Unit Tests** - модульные тесты Python скриптов
3. **SonarQube** - проверка готовности к анализу кода
4. **Functional Tests** - доступность всех сервисов

**Критерии успеха**:
- ≥ 80% тестов пройдено → Система готова
- 50-80% → Требует доработки
- < 50% → Критические проблемы

### Шаг 2.2: Просмотр отчета

```powershell
# Последний отчет тестирования
Get-ChildItem logs/test-report-*.txt | Sort-Object LastWriteTime -Descending | Select-Object -First 1 | Get-Content
```

**Пример успешного отчета**:
```
ИТОГОВЫЙ ОТЧЕТ
================================================
Всего тестов:     15
Успешно:          15
Провалено:        0
Процент успеха:   100%

✅ ВСЕ ТЕСТЫ УСПЕШНО ПРОЙДЕНЫ!
```

---

## Этап 3: Ручное тестирование (15-30 минут)

### Шаг 3.1: Создание задачи в Redmine

1. Откройте http://localhost:3000
2. Войдите как `admin` / `admin`
3. Проекты → ut103-ci → Новая задача
4. Заполните:
   - **Тема**: "Проверка внешнего отчета УТ-103"
   - **Трекер**: Задача
   - **Описание**: Используйте шаблон из `docs/TESTING-GUIDE.md`
   - **Назначена**: developer

### Шаг 3.2: Подготовка внешнего отчета

```powershell
# Создание структуры для внешних отчетов
New-Item -ItemType Directory -Path "workspace/external-reports" -Force

# Здесь вы должны:
# 1. Создать или скопировать внешний отчет (Report_UT103.erf)
# 2. Поместить его в workspace/external-reports/
```

**Примечание**: В реальном проекте вы будете работать с существующим отчетом из 1С.

### Шаг 3.3: Тестирование отчета в 1С

Используйте чеклист из `docs/MANUAL-TESTING-CHECKLIST.md`:

**Ключевые проверки**:
- [ ] Отчет загружается в толстый клиент
- [ ] Реквизиты заполнены корректно
- [ ] Отчет формируется за < 5 секунд
- [ ] Печатная форма работает
- [ ] Экспорт в Excel работает

### Шаг 3.4: Проверка изменений конфигурации

**Ключевые проверки**:
- [ ] Конфигурация открывается без ошибок
- [ ] Синтаксическая проверка пройдена
- [ ] База обновляется
- [ ] Права доступа корректны

### Шаг 3.5: Документирование результатов

1. Заполните чеклист `docs/MANUAL-TESTING-CHECKLIST.md`
2. Сделайте скриншоты проблемных мест (если есть)
3. Обновите задачу в Redmine:
   - Добавьте комментарий с результатами
   - Прикрепите скриншоты
   - Измените статус на "Решена" (если всё ОК)

---

## Полезные команды

### Управление Docker

```powershell
# Статус контейнеров
docker ps

# Логи конкретного контейнера
docker logs -f gitlab
docker logs -f redmine
docker logs -f sonarqube

# Перезапуск контейнера
docker restart gitlab

# Остановка всех контейнеров
docker-compose -f docker-compose-full-stack.yml down

# Перезапуск всех контейнеров
docker-compose -f docker-compose-full-stack.yml restart
```

### Управление GitSync

```powershell
# Ручной запуск GitSync
.\gitsync-run.ps1

# Просмотр логов
Get-Content logs/gitsync-service.log -Tail 50 -Wait

# Проверка конфигурации
Get-Content workspace/gitsync.json
```

### Работа с тестами

```powershell
# Только PreCommit1C
.\scripts\testing\run-automated-tests.ps1 -SkipUnitTests -SkipSonar -SkipFunctional

# Только интеграционные тесты Python
python -m pytest tests/integration -v

# Только unit тесты
python -m pytest tests/unit -v
```

---

## Решение типичных проблем

### Проблема: GitLab не запускается

```powershell
# Проверка логов
docker logs gitlab | Select-String "ERROR"

# Перезапуск с очисткой
docker-compose -f docker-compose-full-stack.yml down
docker system prune -f
docker-compose -f docker-compose-full-stack.yml up -d
```

### Проблема: Токены не работают

1. Проверьте срок действия токенов
2. Убедитесь что токены имеют правильные права (scope)
3. Пересоздайте токены если нужно

### Проблема: Тесты падают

```powershell
# Проверка доступности сервисов
Test-NetConnection localhost -Port 8929  # GitLab
Test-NetConnection localhost -Port 3000  # Redmine
Test-NetConnection localhost -Port 9000  # SonarQube

# Просмотр логов тестов
Get-Content logs/pytest.log
Get-Content logs/test-report-*.txt | Select-Object -Last 1 | Get-Content
```

### Проблема: GitSync падает

```powershell
# Проверка конфигурации
$config = Get-Content workspace/gitsync.json | ConvertFrom-Json
Write-Host "Путь к платформе: $($config.v8version)"
Write-Host "Путь к хранилищу: $($config.storage.path)"

# Проверка доступности хранилища
Test-Path "C:\1crepository"
```

---

## Чек-лист готовности системы

После выполнения всех этапов проверьте:

**Инфраструктура**:
- [ ] Все Docker контейнеры запущены
- [ ] GitLab доступен (http://localhost:8929)
- [ ] Redmine доступен (http://localhost:3000)
- [ ] SonarQube доступен (http://localhost:9000)
- [ ] PostgreSQL работает (localhost:5433)

**Данные и конфигурация**:
- [ ] Токены созданы и сохранены
- [ ] Файл .env заполнен
- [ ] Проекты созданы во всех системах
- [ ] Пользователи загружены
- [ ] GitLab Runner настроен

**Тестирование**:
- [ ] Автоматизированные тесты пройдены (≥ 80%)
- [ ] Отчет тестирования создан
- [ ] Задача в Redmine создана
- [ ] Ручное тестирование проведено
- [ ] Результаты задокументированы

**Документация**:
- [ ] Чеклист заполнен
- [ ] Скриншоты созданы (если нужно)
- [ ] Проблемы описаны
- [ ] Рекомендация дана

---

## Следующие шаги

После завершения тестирования:

1. **Анализ результатов**
   - Просмотрите все отчеты
   - Оцените критичность найденных проблем
   - Примите решение о готовности к выпуску

2. **Исправление проблем** (если есть)
   - Создайте задачи на исправление
   - Назначьте ответственных
   - Установите сроки

3. **Повторное тестирование** (если были исправления)
   - Запустите автоматизированные тесты
   - Проверьте исправленные проблемы
   - Проведите регрессию

4. **Выпуск в продуктив**
   - Получите финальное одобрение
   - Выполните развертывание
   - Проверьте работу в продуктиве

---

## Дополнительные ресурсы

- **Полное руководство**: `docs/TESTING-GUIDE.md`
- **Чеклист ручного тестирования**: `docs/MANUAL-TESTING-CHECKLIST.md`
- **Документация скриптов**: `scripts/README.md`
- **Инфраструктура**: `INFRASTRUCTURE.md`
- **Финальный отчет**: `ФИНАЛЬНЫЙ-ОТЧЕТ.md`

---

## Контакты и поддержка

**Автор**: Бостанов Ф.А.  
**Email**: ci@1c-cicd.local  
**Репозиторий**: https://github.com/bostanov/cicdut103

---

**Версия**: 1.0  
**Последнее обновление**: 6 ноября 2025


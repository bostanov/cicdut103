# ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–ë–õ–ï–ú–ê: GitLab –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞

**–î–∞—Ç–∞**: 12 –Ω–æ—è–±—Ä—è 2025, 18:25

### –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏:
- ‚úÖ Docker —Ä–∞–±–æ—Ç–∞–µ—Ç (–≤–µ—Ä—Å–∏—è 28.5.1)
- ‚úÖ –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä GitLab –∑–∞–ø—É—â–µ–Ω
- ‚ùå **–ö–†–ò–¢–ò–ß–ù–û: –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø–∞–º—è—Ç–∏!**
  - –¢–µ–∫—É—â–µ–µ: **1.92 GB**
  - –¢—Ä–µ–±—É–µ—Ç—Å—è: **–º–∏–Ω–∏–º—É–º 8 GB**
- ‚ùå –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω (502 Bad Gateway)
- ‚ùå Rails –Ω–µ –º–æ–∂–µ—Ç –∑–∞–ø—É—Å—Ç–∏—Ç—å—Å—è

### –û—à–∏–±–∫–∞ –≤ –ª–æ–≥–∞—Ö:
```
dial unix /var/opt/gitlab/gitlab-rails/sockets/gitlab.socket: 
connect: connection refused
```

–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ Rails –ø—Ä–æ—Ü–µ—Å—Å –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∏–∑-–∑–∞ –Ω–µ—Ö–≤–∞—Ç–∫–∏ –ø–∞–º—è—Ç–∏.

## üîß –†–ï–®–ï–ù–ò–ï

### –®–∞–≥ 1: –£–≤–µ–ª–∏—á–∏—Ç—å –ø–∞–º—è—Ç—å Docker Desktop

1. **–û—Ç–∫—Ä–æ–π—Ç–µ Docker Desktop**
   - –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∏–∫–æ–Ω–∫—É Docker –≤ —Ç—Ä–µ–µ
   - –í—ã–±–µ—Ä–∏—Ç–µ "Settings" (–ù–∞—Å—Ç—Ä–æ–π–∫–∏)

2. **–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ Resources**
   - –í –ª–µ–≤–æ–º –º–µ–Ω—é –≤—ã–±–µ—Ä–∏—Ç–µ "Resources"
   - –ó–∞—Ç–µ–º "Advanced" –∏–ª–∏ "Memory"

3. **–£–≤–µ–ª–∏—á—å—Ç–µ –ø–∞–º—è—Ç—å**
   - **Memory**: —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ **8 GB** (–º–∏–Ω–∏–º—É–º) –∏–ª–∏ **12 GB** (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
   - **CPUs**: –æ—Å—Ç–∞–≤—å—Ç–µ 4 (—É–∂–µ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ)
   - **Swap**: —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 2 GB

4. **–ü—Ä–∏–º–µ–Ω–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è**
   - –ù–∞–∂–º–∏—Ç–µ "Apply & Restart"
   - Docker Desktop –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—Å—è (—ç—Ç–æ –∑–∞–π–º–µ—Ç 1-2 –º–∏–Ω—É—Ç—ã)

### –®–∞–≥ 2: –î–æ–∂–¥–∏—Ç–µ—Å—å –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ Docker

–ü–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ Docker –≤—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å—Ç—è—Ç—Å—è.

–ü–æ–¥–æ–∂–¥–∏—Ç–µ **5-10 –º–∏–Ω—É—Ç** –¥–ª—è –ø–æ–ª–Ω–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ GitLab.

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å

–ó–∞–ø—É—Å—Ç–∏—Ç–µ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É —Å–Ω–æ–≤–∞:
```powershell
.\scripts\diagnose_gitlab.ps1
```

–ò–ª–∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –≤—Ä—É—á–Ω—É—é:
```powershell
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
curl.exe http://localhost:8929

# –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å HTML —Å—Ç—Ä–∞–Ω–∏—Ü—É, –∞ –Ω–µ 502 –æ—à–∏–±–∫—É
```

### –®–∞–≥ 4: –°–æ–∑–¥–∞–π—Ç–µ —Ç–æ–∫–µ–Ω

–ü–æ—Å–ª–µ —Ç–æ–≥–æ –∫–∞–∫ GitLab –∑–∞—Ä–∞–±–æ—Ç–∞–µ—Ç:

1. –û—Ç–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä: http://localhost:8929
2. –í–æ–π–¥–∏—Ç–µ:
   - Username: **root**
   - Password: **rootpassword123**
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ Settings -> Access Tokens
4. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π —Ç–æ–∫–µ–Ω:
   - Name: **API Token**
   - Expiration: –æ—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º
   - Scopes: –æ—Ç–º–µ—Ç—å—Ç–µ **api**, **read_repository**, **write_repository**
5. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ç–æ–∫–µ–Ω (–æ–Ω –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑!)
6. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –≤ —Ñ–∞–π–ª `.env.gitlab`:
   ```
   GITLAB_TOKEN=–≤–∞—à_—Ç–æ–∫–µ–Ω_–∑–¥–µ—Å—å
   GITLAB_URL=http://localhost:8929
   ```

### –®–∞–≥ 5: –ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫—É

–ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–æ–∫–µ–Ω–∞ –∑–∞–ø—É—Å—Ç–∏—Ç–µ:
```powershell
python scripts/init_gitlab.py
```

## üìä –ü–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ?

GitLab - —ç—Ç–æ —Å–ª–æ–∂–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –≤–∫–ª—é—á–∞–µ—Ç:
- Ruby on Rails (–≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ)
- PostgreSQL (–±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö)
- Redis (–∫–µ—à –∏ –æ—á–µ—Ä–µ–¥–∏)
- Sidekiq (—Ñ–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏)
- Gitaly (Git —Å–µ—Ä–≤–µ—Ä)
- Nginx (–≤–µ–±-—Å–µ—Ä–≤–µ—Ä)
- Workhorse (–ø—Ä–æ–∫—Å–∏)

–í—Å–µ —ç—Ç–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –∏ —Ç—Ä–µ–±—É—é—Ç –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã—Ö —Ä–µ—Å—É—Ä—Å–æ–≤.

### –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è GitLab:
- **RAM**: 8 GB (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 12 GB)
- **CPU**: 4 cores
- **Disk**: 10 GB

### –¢–µ–∫—É—â–∏–µ —Ä–µ—Å—É—Ä—Å—ã Docker:
- **RAM**: 1.92 GB ‚ùå
- **CPU**: 4 cores ‚úÖ
- **Disk**: –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ ‚úÖ

## üöÄ –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

–ï—Å–ª–∏ —É–≤–µ–ª–∏—á–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ:

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å GitLab.com (–æ–±–ª–∞–∫–æ)
- –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π –ø–ª–∞–Ω: https://gitlab.com
- –ù–µ —Ç—Ä–µ–±—É–µ—Ç –ª–æ–∫–∞–ª—å–Ω—ã—Ö —Ä–µ—Å—É—Ä—Å–æ–≤
- –ì–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é —Å—Ä–∞–∑—É
- –ú–∏–Ω—É—Å—ã: –¥–∞–Ω–Ω—ã–µ –≤ –æ–±–ª–∞–∫–µ, —Ç—Ä–µ–±—É–µ—Ç—Å—è –∏–Ω—Ç–µ—Ä–Ω–µ—Ç

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–æ–ª–µ–µ –ª–µ–≥–∫—É—é –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—É
- **Gitea**: –ª–µ–≥–∫–æ–≤–µ—Å–Ω—ã–π Git —Å–µ—Ä–≤–µ—Ä (~200 MB RAM)
- **Gogs**: –µ—â–µ –±–æ–ª–µ–µ –ª–µ–≥–∫–∏–π (~100 MB RAM)
- –ú–∏–Ω—É—Å—ã: –º–µ–Ω—å—à–µ —Ñ—É–Ω–∫—Ü–∏–π, —á–µ–º GitLab

### –í–∞—Ä–∏–∞–Ω—Ç 3: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å GitLab –≤ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
–û—Ç–∫–ª—é—á–∏—Ç—å –Ω–µ–Ω—É–∂–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –≤ `docker-compose.yml`:
```yaml
environment:
  GITLAB_OMNIBUS_CONFIG: |
    # –û—Ç–∫–ª—é—á–∏—Ç—å Container Registry
    registry['enable'] = false
    # –û—Ç–∫–ª—é—á–∏—Ç—å Mattermost
    mattermost['enable'] = false
    # –û—Ç–∫–ª—é—á–∏—Ç—å Prometheus
    prometheus_monitoring['enable'] = false
```

–≠—Ç–æ –º–æ–∂–µ—Ç —Å–Ω–∏–∑–∏—Ç—å –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏ –¥–æ ~4-6 GB.

## üìû –ß—Ç–æ –¥–µ–ª–∞—Ç—å –¥–∞–ª—å—à–µ?

1. **–£–≤–µ–ª–∏—á—å—Ç–µ –ø–∞–º—è—Ç—å Docker –¥–æ 8-12 GB** (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
2. –ü–æ–¥–æ–∂–¥–∏—Ç–µ 5-10 –º–∏–Ω—É—Ç –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞
3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É: `.\scripts\diagnose_gitlab.ps1`
4. –°–æ–∑–¥–∞–π—Ç–µ —Ç–æ–∫–µ–Ω –≤—Ä—É—á–Ω—É—é (—Å–º. `GITLAB_TOKEN_MANUAL.md`)
5. –ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫—É: `python scripts/init_gitlab.py`

## üìù –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```powershell
# –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
.\scripts\diagnose_gitlab.ps1

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞–º—è—Ç–∏ Docker
docker info | Select-String "Total Memory"

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ GitLab
docker restart gitlab-cicd

# –õ–æ–≥–∏ GitLab
docker logs gitlab-cicd --tail 50

# –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–æ–≤
docker exec gitlab-cicd gitlab-ctl status

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
curl.exe http://localhost:8929
```

## ‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞

GitLab —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ, –µ—Å–ª–∏:
1. `curl.exe http://localhost:8929` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç HTML (–Ω–µ 502)
2. –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –≤ –±—Ä–∞—É–∑–µ—Ä–µ
3. –ú–æ–∂–Ω–æ –≤–æ–π—Ç–∏ –∫–∞–∫ root / rootpassword123
4. –ú–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å Personal Access Token
5. API –æ—Ç–≤–µ—á–∞–µ—Ç: `curl.exe -H "PRIVATE-TOKEN: —Ç–æ–∫–µ–Ω" http://localhost:8929/api/v4/user`

---

**–ù–µ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–π—Ç–µ—Å—å! –ü—Ä–æ–±–ª–µ–º–∞ —Ä–µ—à–∞–µ–º–∞. –ü—Ä–æ—Å—Ç–æ —É–≤–µ–ª–∏—á—å—Ç–µ –ø–∞–º—è—Ç—å Docker –∏ –ø–æ–¥–æ–∂–¥–∏—Ç–µ 5-10 –º–∏–Ω—É—Ç.**

# Руководство разработчика по системе 1C-CI/CD

## Обзор системы

Система 1C-CI/CD автоматизирует процессы разработки, контроля качества кода и версионного контроля для конфигурации 1С УТ 10.3.

### Компоненты системы

1. **GitSync** - автоматическая синхронизация хранилища конфигурации с Git
2. **SonarQube** - анализ качества кода
3. **GitLab** - централизованное хранение исходного кода и CI/CD
4. **Redmine** - управление задачами и проектами
5. **PreCommit1C** - разбор внешних отчетов и обработок

## Процесс разработки

### 1. Работа с задачами в Redmine

1. Создайте задачу в Redmine: http://localhost:3000
2. Укажите тип задачи (разработка, исправление, доработка)
3. Приоритет и сроки выполнения
4. Описание требований

### 2. Разработка в конфигурации 1С

1. Откройте конфигуратор 1С
2. Подключитесь к хранилищу: `file://C:/1crepository`
3. Создайте ветку для задачи (если необходимо)
4. Выполните изменения в конфигурации
5. Фиксируйте изменения в хранилище с комментарием: `[#12345] Описание изменений`

### 3. Автоматическая синхронизация

- GitSync автоматически синхронизирует изменения каждые 10 минут
- Обычные формы автоматически распаковываются
- Изменения отправляются в GitLab

### 4. Анализ качества кода

- SonarQube автоматически анализирует код при коммитах
- Результаты анализа доступны в SonarQube: http://localhost:9000
- Проект: `ut103-ci`

### 5. Работа с внешними файлами

1. Прикрепите файл (.epf/.erf) к задаче в Redmine
2. Система автоматически:
   - Скачает файл
   - Разберет его на исходные компоненты
   - Добавит в Git репозиторий
   - Проанализирует качество кода

## Стандарты кодирования

### Именование объектов

- **Справочники**: `СправочникНазвание` (например: `СправочникНоменклатура`)
- **Документы**: `ДокументНазвание` (например: `ДокументПоступлениеТоваров`)
- **Регистры**: `РегистрНазвание` (например: `РегистрОстаткиТоваров`)
- **Перечисления**: `ПеречислениеНазвание` (например: `ПеречислениеСтатусыЗаказов`)

### Именование процедур и функций

- **Процедуры**: `ИмяПроцедуры` (например: `ОбработатьПроведение`)
- **Функции**: `ПолучитьИмя` (например: `ПолучитьНоменклатуру`)
- **Обработчики событий**: `ПриСобытии` (например: `ПриСозданииНаСервере`)

### Комментарии

```bsl
// Процедура обрабатывает проведение документа
// Параметры:
//  Отказ - Булево, признак отказа от проведения
//  РежимПроведения - ПеречислениеСсылка.РежимыПроведенияДокументов
Процедура ОбработатьПроведение(Отказ, РежимПроведения) Экспорт
    
    // Проверяем корректность данных
    Если НЕ ПроверитьДанные() Тогда
        Отказ = Истина;
        Возврат;
    КонецЕсли;
    
    // Выполняем проводку
    ВыполнитьПроводку();
    
КонецПроцедуры
```

### Структура модулей

1. **Объявления переменных** (если есть)
2. **Процедуры и функции** (сортировка по алфавиту)
3. **Обработчики событий** (в конце модуля)

## Работа с Git

### Основные команды

```bash
# Просмотр статуса
git status

# Просмотр изменений
git diff

# Добавление файлов
git add .

# Коммит
git commit -m "[#12345] Описание изменений"

# Отправка в GitLab
git push origin master
```

### Формат сообщений коммитов

```
[#12345] Краткое описание изменений

Подробное описание изменений:
- Что было изменено
- Зачем было изменено
- Какие файлы затронуты
```

## Мониторинг и логирование

### Просмотр логов

- **GitSync**: `C:\1C-CI-CD\logs\gitsync-service-working.log`
- **Redmine Monitoring**: `C:\1C-CI-CD\logs\redmine-monitoring.log`
- **Service Monitoring**: `C:\1C-CI-CD\logs\service-monitoring.log`
- **Centralized Logging**: `C:\1C-CI-CD\logs\centralized.log`

### Мониторинг сервисов

- **SonarQube**: http://localhost:9000
- **Redmine**: http://localhost:3000
- **GitLab**: http://localhost:8929

## Устранение неполадок

### GitSync не синхронизирует

1. Проверьте статус задачи в планировщике:
   ```powershell
   Get-ScheduledTask -TaskName "GitSync-Sync"
   ```

2. Проверьте логи:
   ```powershell
   Get-Content "C:\1C-CI-CD\logs\gitsync-service-working.log" -Tail 20
   ```

3. Перезапустите задачу:
   ```powershell
   Restart-ScheduledTask -TaskName "GitSync-Sync"
   ```

### SonarQube не анализирует код

1. Проверьте доступность: http://localhost:9000
2. Проверьте токен в `sonarqube-token.txt`
3. Проверьте настройки проекта в SonarQube

### Redmine не обрабатывает файлы

1. Проверьте статус задачи мониторинга:
   ```powershell
   Get-ScheduledTask -TaskName "Redmine-Monitoring"
   ```

2. Проверьте логи:
   ```powershell
   Get-Content "C:\1C-CI-CD\logs\redmine-monitoring.log" -Tail 20
   ```

## Контакты и поддержка

- **Администратор системы**: [указать контакты]
- **Документация**: [ссылка на документацию]
- **Техническая поддержка**: [контакты поддержки]

## Часто задаваемые вопросы

### Q: Как добавить новый проект в SonarQube?

A: Используйте скрипт `setup-sonarqube.ps1` с новым ключом проекта.

### Q: Как изменить интервал синхронизации GitSync?

A: Отредактируйте переменную `$SyncIntervalMinutes` в файле `ci\scripts\gitsync-service-working.ps1`.

### Q: Как добавить новый тип файлов для обработки в Redmine?

A: Отредактируйте массив `$fileExtension` в файле `redmine-monitoring-service.ps1`.

### Q: Как просмотреть все активные задачи планировщика?

A: Выполните команду:
```powershell
Get-ScheduledTask | Where-Object {$_.State -eq "Running"}
```


# План проверки работоспособности и тестирования системы

**Проект**: UT-103 CI/CD для 1С:Предприятие 8.3.12  
**Автор**: Бостанов Ф.А.  
**Версия**: 1.0  
**Дата**: 6 ноября 2025

---

## Обзор

Данный документ описывает полный план проверки и тестирования CI/CD системы, разделенный на два основных этапа:

1. **Автоматизированный этап тестирования** - проверка работоспособности инфраструктуры
2. **Ручное тестирование** - проверка внешнего отчета и изменений конфигурации

---

## Структура созданных компонентов

```
C:\1C-CI-CD\
│
├── scripts/                                # Скрипты автоматизации
│   ├── setup/                             # Первоначальная настройка
│   │   ├── init-all.ps1                   # Полная инициализация (все шаги)
│   │   ├── init-projects.py               # Создание проектов в GitLab/Redmine/SonarQube
│   │   ├── init-runner.ps1                # Настройка GitLab Runner
│   │   └── load-seed-data.py              # Загрузка эталонных данных
│   │
│   ├── testing/                           # Тестирование
│   │   └── run-automated-tests.ps1        # Автоматизированные тесты
│   │
│   └── README.md                          # Документация скриптов
│
├── tests/                                  # Тесты Python
│   ├── unit/                              # Unit тесты
│   │   └── test_init_projects.py
│   ├── integration/                       # Интеграционные тесты
│   │   └── test_services_integration.py
│   └── conftest.py                        # Конфигурация pytest
│
├── docs/                                   # Документация
│   ├── TESTING-GUIDE.md                   # Полное руководство по тестированию
│   ├── MANUAL-TESTING-CHECKLIST.md        # Чеклист ручного тестирования
│   └── QUICK-START.md                     # Быстрый старт
│
├── .env                                    # Переменные окружения (создается автоматически)
├── requirements.txt                        # Python зависимости
├── pytest.ini                             # Конфигурация pytest
├── sonar-project.properties               # Конфигурация SonarQube
│
└── TEST-PLAN-SUMMARY.md                   # Этот файл

```

---

## Этап 1: Первоначальное заполнение систем

### Цель
Подготовить и заполнить все компоненты CI/CD системы для последующего тестирования.

### Задачи

#### 1.1. Запуск Docker сервисов
- Запуск GitLab, Redmine, SonarQube, PostgreSQL
- Ожидание инициализации (может занять 5-10 минут)
- Проверка доступности через health checks

**Команда**:
```powershell
docker-compose -f docker-compose-full-stack.yml up -d
```

#### 1.2. Получение токенов доступа
- GitLab: Personal Access Token (api, read_repository, write_repository)
- Redmine: API Key из профиля пользователя
- SonarQube: User Token для анализа кода

**Сохранение**:
- `secrets/gitlab_token.txt`
- `secrets/redmine_api_key.txt`
- `secrets/sonarqube_token.txt`

#### 1.3. Создание проектов
- Проект в GitLab (ut-103-ci-cd)
- Проект в Redmine (ut103-ci)
- Проект в SonarQube (ut103-ci)

**Команда**:
```powershell
python scripts/setup/init-projects.py
```

#### 1.4. Настройка интеграций
- Webhooks между GitLab и Redmine
- Webhooks между SonarQube и GitLab
- Синхронизация пользователей

#### 1.5. Загрузка эталонных данных
- Пользователи: admin, developer, tester, analyst
- Роли и права доступа
- Трекеры задач, статусы, приоритеты

**Команда**:
```powershell
python scripts/setup/load-seed-data.py
```

#### 1.6. Настройка GitLab Runner
- Регистрация runner в GitLab
- Настройка тегов (1c-tests, sonar, deploy)
- Проверка доступности через Docker

**Команда**:
```powershell
.\scripts\setup\init-runner.ps1 -RunnerToken "YOUR_TOKEN"
```

### Автоматизация

**Полная автоматическая инициализация**:
```powershell
.\scripts\setup\init-all.ps1
```

Этот скрипт выполняет все шаги 1.1-1.6 автоматически с интерактивными подсказками.

### Критерии успеха
- ✅ Все Docker контейнеры запущены и healthy
- ✅ Проекты созданы во всех системах
- ✅ Пользователи и роли загружены
- ✅ GitLab Runner зарегистрирован
- ✅ Webhooks настроены

---

## Этап 2: Автоматизированное тестирование

### Цель
Проверить работоспособность всех компонентов CI/CD системы автоматически.

### Задачи

#### 2.1. PreCommit1C - Синтаксическая проверка
- Проверка наличия OneScript
- Поиск модулей 1С (*.bsl, *.os) в workspace
- Синтаксическая проверка модулей
- Контроль стиля и соглашений

**Что проверяется**:
- Синтаксис 1С модулей корректен
- Нет критичных ошибок
- Стиль кода соответствует стандартам

#### 2.2. Unit Tests - Модульные тесты
- Запуск Python unit тестов (pytest)
- Проверка функций инициализации проектов
- Проверка работы с API сервисов
- Покрытие кода (если настроено)

**Что проверяется**:
- Функции работают корректно
- Mock-объекты обрабатываются правильно
- Нет регрессий в коде

#### 2.3. Integration Tests - Интеграционные тесты
- Проверка доступности всех сервисов
- Тестирование API GitLab, Redmine, SonarQube
- Проверка аутентификации
- Проверка производительности API

**Что проверяется**:
- Все сервисы доступны
- API отвечают корректно
- Время ответа приемлемо (< 2-3 сек)

#### 2.4. SonarQube Analysis - Анализ кода
- Проверка установки SonarScanner
- Проверка конфигурации (sonar-project.properties)
- Подготовка к анализу кода
- Проверка доступности SonarQube API

**Что проверяется**:
- SonarQube готов к анализу
- Конфигурация корректна
- Проект существует в SonarQube

#### 2.5. Functional Tests - Функциональные тесты
- Проверка всех сервисов (GitLab, Redmine, SonarQube, PostgreSQL)
- Проверка GitSync логов
- Проверка доступности портов
- Проверка сетевого взаимодействия

**Что проверяется**:
- Все сервисы работают
- GitSync выполняется без ошибок
- Сеть cicd-network функционирует

### Запуск

**Полный цикл**:
```powershell
.\scripts\testing\run-automated-tests.ps1
```

**Выборочные тесты**:
```powershell
# Только PreCommit1C
.\scripts\testing\run-automated-tests.ps1 -SkipUnitTests -SkipSonar -SkipFunctional

# Только Python тесты
python -m pytest tests/ -v
```

### Отчеты

После выполнения создаются:
- `logs/test-report-YYYYMMDD-HHmmss.txt` - итоговый отчет
- `logs/pytest.log` - детальные логи pytest
- Вывод в консоль с цветовым кодированием

**Пример отчета**:
```
ИТОГОВЫЙ ОТЧЕТ
================================================
Всего тестов:     15
Успешно:          15
Провалено:        0
Процент успеха:   100%

✅ ВСЕ ТЕСТЫ УСПЕШНО ПРОЙДЕНЫ!
```

### Критерии успеха
- ✅ Процент успешных тестов ≥ 80%
- ✅ Все критичные сервисы доступны
- ✅ Нет критичных ошибок в логах
- ✅ Производительность приемлема

---

## Этап 3: Ручное тестирование

### Цель
Провести детальную проверку внешнего отчета и изменений конфигурации 1С через UI.

### Задачи

#### 3.1. Создание задачи в Redmine
- Создание проекта для тестирования (если нужно)
- Создание задачи с детальным описанием
- Добавление чеклиста проверки
- Назначение ответственного

**Шаблон задачи** предоставлен в `docs/TESTING-GUIDE.md`

#### 3.2. Подготовка внешнего отчета
- Создание структуры директорий
- Размещение файла отчета (*.erf)
- Разборка через GitSync (если нужно)
- Проверка исходников

**Путь**: `workspace/external-reports/Report_UT103.erf`

#### 3.3. Тестирование отчета в 1С

**Подэтапы**:

1. **Загрузка отчета**
   - Запуск 1С в толстом клиенте
   - Открытие внешнего отчета
   - Проверка отсутствия ошибок

2. **Проверка реквизитов**
   - Период (даты)
   - Организация (справочник)
   - Детализация (перечисление)
   - Другие параметры

3. **Формирование отчета**
   - Заполнение параметров
   - Формирование
   - Проверка времени (< 5 сек)
   - Проверка данных

4. **Печатная форма**
   - Открытие печатной формы
   - Проверка форматирования
   - Печать/сохранение в PDF

5. **Экспорт**
   - Экспорт в Excel
   - Проверка открытия в Excel
   - Проверка структуры и данных

#### 3.4. Проверка изменений конфигурации

**Подэтапы**:

1. **Сборка конфигурации**
   - Открытие в Конфигураторе
   - Проверка отсутствия ошибок открытия

2. **Синтаксическая проверка**
   - Конфигурация → Проверить конфигурацию
   - Анализ ошибок и предупреждений
   - Документирование проблем

3. **Обновление базы**
   - Создание тестовой базы
   - Обновление конфигурации БД
   - Проверка успешности
   - Запуск базы

4. **Права доступа**
   - Проверка ролей
   - Проверка назначения прав
   - Тестирование доступа

5. **Интеграции**
   - Внешние соединения (HTTP, COM, Web)
   - Обмен данными
   - Синхронизация

#### 3.5. Регрессионное тестирование
- Выполнение базовых операций (создание, редактирование, проведение документов)
- Проверка отчета после изменений
- Проверка критичных операций бизнес-процессов

#### 3.6. Документирование результатов
- Заполнение чеклиста `docs/MANUAL-TESTING-CHECKLIST.md`
- Создание скриншотов
- Обновление задачи в Redmine
- Добавление комментария с результатами
- Изменение статуса задачи

### Чеклист

Используйте `docs/MANUAL-TESTING-CHECKLIST.md` для пошаговой проверки.

**Основные разделы чеклиста**:
1. Подготовка окружения
2. Тестирование внешнего отчета
3. Тестирование конфигурации
4. Регрессионное тестирование
5. Документирование
6. Итоговая оценка

### Критерии успеха
- ✅ Все пункты чеклиста выполнены
- ✅ Нет критичных ошибок
- ✅ Производительность приемлема
- ✅ Результаты задокументированы

---

## Итоговые критерии готовности системы

### Обязательные требования

**Инфраструктура**:
- ✅ Все Docker контейнеры работают стабильно
- ✅ Все сервисы доступны через указанные порты
- ✅ Сеть cicd-network функционирует

**Данные и конфигурация**:
- ✅ Проекты созданы во всех системах
- ✅ Пользователи и роли загружены
- ✅ Токены и ключи настроены
- ✅ GitLab Runner зарегистрирован

**Автоматизированное тестирование**:
- ✅ ≥ 80% тестов пройдено
- ✅ Отчет создан и проверен
- ✅ Критичных ошибок нет

**Ручное тестирование**:
- ✅ Внешний отчет работает корректно
- ✅ Конфигурация проходит проверку
- ✅ Регрессия не обнаружена
- ✅ Задача в Redmine оформлена

### Рекомендации по принятию решения

**Готово к выпуску** если:
- Все обязательные требования выполнены
- Нет критичных ошибок
- Все найденные проблемы документированы
- Получено одобрение от аналитика/владельца продукта

**Требует доработки** если:
- Есть некритичные проблемы, требующие исправления
- Процент успешных тестов < 80%
- Производительность неприемлема

**Отклонено** если:
- Есть критичные ошибки
- Основная функциональность не работает
- Система нестабильна

---

## Полезные команды и справочники

### Быстрый старт

```powershell
# 1. Полная инициализация
.\scripts\setup\init-all.ps1

# 2. Автоматизированное тестирование
.\scripts\testing\run-automated-tests.ps1

# 3. Открыть руководство по ручному тестированию
code docs/TESTING-GUIDE.md
code docs/MANUAL-TESTING-CHECKLIST.md
```

### Управление

```powershell
# Docker
docker ps                                          # Статус
docker logs -f gitlab                              # Логи
docker restart redmine                             # Перезапуск

# GitSync
.\gitsync-run.ps1                                  # Запуск
Get-Content logs/gitsync-service.log -Tail 50      # Логи

# Тесты
python -m pytest tests/unit -v                     # Unit
python -m pytest tests/integration -v              # Integration
```

### Ресурсы

- **Документация**: `docs/`
- **Скрипты**: `scripts/`
- **Тесты**: `tests/`
- **Логи**: `logs/`
- **Конфигурация**: `.env`, `pytest.ini`, `sonar-project.properties`

---

## Контакты и поддержка

**Автор**: Бостанов Ф.А.  
**Email**: ci@1c-cicd.local  
**Репозиторий**: https://github.com/bostanov/cicdut103  

**Документы**:
- Быстрый старт: `docs/QUICK-START.md`
- Полное руководство: `docs/TESTING-GUIDE.md`
- Чеклист: `docs/MANUAL-TESTING-CHECKLIST.md`
- Инфраструктура: `INFRASTRUCTURE.md`

---

**Версия плана**: 1.0  
**Дата создания**: 6 ноября 2025  
**Статус**: ✅ Готов к использованию

